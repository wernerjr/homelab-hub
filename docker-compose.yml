services:
  # Uses the shared PostgreSQL container already running on this host:
  #   container: shared-postgres
  #   port: 5432
  homelab-hub:
    build: .
    container_name: homelab-hub
    restart: unless-stopped
    environment:
      - NODE_ENV=production
      - HOST=0.0.0.0
      - PORT=8080
      - STATIC_DIR=/app/backend/public
      - CORS_ORIGIN=http://localhost
      - SERVER_NAME=homelab-hub
      - DATABASE_URL=postgres://promptvault:promptvault@host.docker.internal:5432/promptvault
      - METRICS_MODE=auto
      - DISK_MOUNT=/
      - APPS_PING_INTERVAL_SEC=60
      - APPS_PING_TIMEOUT_MS=3000
    extra_hosts:
      - "host.docker.internal:host-gateway"
    group_add:
      - "999" # systemd-journal on Ubuntu
    volumes:
      - /var/log/journal:/var/log/journal:ro
      - /run/log/journal:/run/log/journal:ro
      - /etc/machine-id:/etc/machine-id:ro
    ports:
      - "80:8080"
